#!/usr/bin/env bash

# Java configuration (if available)
if [[ -x /usr/libexec/java_home ]]; then
    export JAVA_HOME=$(/usr/libexec/java_home 2>/dev/null)
fi

# Homebrew configuration
if [[ -x /opt/homebrew/bin/brew ]]; then
    eval "$(/opt/homebrew/bin/brew shellenv)"
elif [[ -x /usr/local/bin/brew ]]; then
    eval "$(/usr/local/bin/brew shellenv)"
fi

# Application paths
declare -a app_paths=(
    "/Applications/Visual Studio Code.app/Contents/Resources/app/bin"
    "/Applications/Emacs.app/Contents/MacOS"
    "/Applications/Emacs.app/Contents/MacOS/bin"
)

for app_path in "${app_paths[@]}"; do
    if [[ -d "$app_path" && ":$PATH:" != *":$app_path:"* ]]; then
        export PATH="$app_path:$PATH"
    fi
done

# Rust/Cargo environment
if [[ -f "$HOME/.cargo/env" ]]; then
    source "$HOME/.cargo/env"
fi

# macOS-specific ls behavior
# Prefer gls (GNU ls) on macOS for better color support
if command -v gls >/dev/null 2>&1; then
    # Use GNU ls with dir_colors support
    alias ls="gls --color=auto"
    alias l="gls -lah --color=auto"
    alias la="gls -lAh --color=auto"
    alias ll="gls -lh --color=auto"
    alias lsa="gls -lah --color=auto"
else
    # Fallback to BSD ls with LSCOLORS
    # Gruvbox-inspired LSCOLORS: directories=blue, executables=green, etc.
    export LSCOLORS="Dxfxcxdxbxegedabagacad"
    alias ls="ls -G"
    alias l="ls -lahG"
    alias la="ls -lAhG"
    alias ll="ls -lhG"
    alias lsa="ls -lahG"
fi

# Application aliases (if available)
if [[ -x "/Applications/Emacs.app/Contents/MacOS/Emacs" ]]; then
    alias emacs="/Applications/Emacs.app/Contents/MacOS/Emacs"
fi

if command -v emacsclient >/dev/null; then
    alias ec="emacsclient -c"
fi

# macOS-specific functions
if command -v pbcopy >/dev/null; then
    alias copy="pbcopy"
    alias paste="pbpaste"
fi
