# ============================================================================
# tmux Configuration - XDG Compliant with Gruvbox Theme
# ============================================================================

# XDG Base Directory Specification compliance
# Note: tmux 3.1+ automatically looks for config in $XDG_CONFIG_HOME/tmux/tmux.conf
# For older versions, you'd need to specify: tmux -f "$XDG_CONFIG_HOME/tmux/tmux.conf"

# ============================================================================
# General Settings
# ============================================================================

# Change prefix key to backtick (more accessible than Ctrl-b)
unbind C-b
set-option -g prefix `
bind ` send-prefix

# Emacs style key bindings
set -g mode-keys emacs
set -g status-keys emacs

# Start windows and panes at 1, not 0 (easier to reach)
set -g base-index 1
set -g pane-base-index 1

# Automatically renumber windows when one is closed
set -g renumber-windows on

# Don't allow programs to rename windows
set-option -g allow-rename off

# Increase scrollback buffer size
set -g history-limit 50000

# Enable mouse support
set-option -g mouse on

# Reduce escape time for faster command sequences
set -sg escape-time 0

# Increase repeat time for repeatable commands
set -g repeat-time 1000

# Focus events enabled for terminals that support them
set -g focus-events on

# Super useful when using "grouped sessions" and multi-monitor setup
setw -g aggressive-resize on

# ============================================================================
# Terminal and Color Settings
# ============================================================================

# Set terminal type with 256 color support
set -g default-terminal "tmux-256color"
set -ga terminal-overrides ",*256col*:Tc"

# Enable RGB color support
set -ga terminal-overrides ",xterm-256color:RGB"

# ============================================================================
# Gruvbox Dark Theme
# ============================================================================

# Gruvbox color palette
# bg0_h: #1d2021, bg0: #282828, bg1: #3c3836, bg2: #504945
# fg0: #fbf1c7, fg1: #ebdbb2, fg2: #d5c4a1, fg3: #bdae93
# red: #cc241d, green: #98971a, yellow: #d79921, blue: #458588
# purple: #b16286, aqua: #689d6a, orange: #d65d0e

# Status bar position and basic styling
set-option -g status-position top
set-option -g status-style "fg=#ebdbb2,bg=#3c3836"
set-option -g status-interval 5

# Status bar left side - session info
set-option -g status-left-length 40
set-option -g status-left "#[fg=#282828,bg=#98971a,bold] #S #[fg=#98971a,bg=#3c3836]"

# Status bar right side - system info
set-option -g status-right-length 80
set-option -g status-right "#[fg=#bdae93,bg=#3c3836] %Y-%m-%d #[fg=#ebdbb2]%H:%M #[fg=#458588,bg=#3c3836]#[fg=#282828,bg=#458588,bold] #h "

# Window status styling
set-window-option -g window-status-style "fg=#bdae93,bg=#3c3836"
set-window-option -g window-status-current-style "fg=#282828,bg=#d79921,bold"
set-window-option -g window-status-activity-style "fg=#cc241d,bg=#3c3836"
set-window-option -g window-status-bell-style "fg=#282828,bg=#cc241d,bold"

# Window status format
set-window-option -g window-status-format " #I:#W#{?window_flags,#{window_flags}, } "
set-window-option -g window-status-current-format " #I:#W#{?window_flags,#{window_flags}, } "

# Pane border colors
set-option -g pane-border-style "fg=#504945"
set-option -g pane-active-border-style "fg=#d79921"

# Message styling
set-option -g message-style "fg=#282828,bg=#d79921,bold"
set-option -g message-command-style "fg=#282828,bg=#98971a,bold"

# Copy mode styling
set-window-option -g mode-style "fg=#282828,bg=#d79921"

# Clock mode color
set-window-option -g clock-mode-colour "#98971a"

# ============================================================================
# Key Bindings
# ============================================================================

# Reload configuration
unbind r
bind r source-file "$XDG_CONFIG_HOME/tmux/tmux.conf" \; display "Config reloaded!"

# Window management
bind c new-window -c "#{pane_current_path}"  # Create new window in current path
bind '"' split-window -c "#{pane_current_path}"  # Split horizontal in current path
bind % split-window -h -c "#{pane_current_path}"  # Split vertical in current path

# Better pane splitting
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"

# Pane navigation (Emacs-style)
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# Pane resizing
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# Window navigation with Alt+number
bind-key -n M-1 select-window -t 1
bind-key -n M-2 select-window -t 2
bind-key -n M-3 select-window -t 3
bind-key -n M-4 select-window -t 4
bind-key -n M-5 select-window -t 5
bind-key -n M-6 select-window -t 6
bind-key -n M-7 select-window -t 7
bind-key -n M-8 select-window -t 8
bind-key -n M-9 select-window -t 9

# Quick window switching
bind -n M-p previous-window
bind -n M-n next-window

# Session management
bind S choose-session
bind N new-session

# Copy mode improvements
bind Enter copy-mode  # Enter copy mode
bind -T copy-mode C-w send-keys -X copy-pipe-and-cancel "pbcopy"  # Copy to clipboard (macOS)
bind -T copy-mode M-w send-keys -X copy-pipe-and-cancel "pbcopy"  # Copy to clipboard (macOS)

# Clear screen and history
bind C-l send-keys 'C-l' \; clear-history

# Toggle synchronize panes
bind S setw synchronize-panes

# ============================================================================
# Plugin Management (TPM)
# ============================================================================

# List of plugins
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'

# Plugin settings
set -g @resurrect-capture-pane-contents 'on'
set -g @continuum-restore 'on'
set -g @continuum-save-interval '15'

# Initialize TMUX plugin manager (keep this line at the very bottom)
run '~/.local/share/tmux/plugins/tpm/tpm'
